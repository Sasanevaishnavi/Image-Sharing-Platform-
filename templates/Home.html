
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>
<style>
    .col-md-4 {
        width: 250px;
        padding: 10px;
    }

    .card-body {
        font-size: 0.9rem;
        padding: 8px;
    }

    .like-btn {
        color: gray;
        cursor: pointer;
        font-size: 1.5rem;
    }

    .like-btn.liked {
        color: red;
    }
</style>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Uploaded Images</h1>
<!--        for like button -->
        <div class="row mt-4">
            {% for image, description, likes in images %}
            <div class="col-md-4">
                <div class="card mb-4">
                    <img src="{{ url_for('static', filename='uploads/' + image) }}" class="card-img-top" alt="Image">

                    <div class="card-body text-center">
                        <p class="card-text">{{ description }}</p>
                        <div>

                            <i class="fas fa-heart like-btn {% if likes > 0 %}liked{% endif %}"
                               data-image-id="{{ image[0] }}"></i>
                            <span class="like-count">{{ likes }}</span> likes
                        </div>

                        <div>
                            <!--        for comment button-->
                            <i class="bi bi-chat-right-text"></i>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-right-text" viewBox="0 0 16 16">
                              <path d="M2 1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h9.586a2 2 0 0 1 1.414.586l2 2V2a1 1 0 0 0-1-1zm12-1a2 2 0 0 1 2 2v12.793a.5.5 0 0 1-.854.353l-2.853-2.853a1 1 0 0 0-.707-.293H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2z"/>
                              <path d="M3 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5M3 6a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 6m0 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5"/>
                            </svg>
                            <span class="comments">{{ comment}}</span> comments
                             <form id="form-{{ image[0] }}" class="comment-form" data-image-id="{{ image[0] }}">
                                <input type="text" name="comment" placeholder="Write a comment..." required>
                                <button type="submit">Post</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>







    <div class="text-center">
        <a href="/upload" class="btn btn-primary mt-3">Upload New Image</a>
    </div>
</div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            $('.like-btn').click(function() {
                const button = $(this);
                const imageId = button.data('image-id');

                // Prevent duplicate clicks
                if (button.hasClass('liked')) {
                    alert("You have already liked this image.");
                    return;
            }

                $.ajax({
                    url: '/like',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ image_id: imageId }),
                    success: function(response) {
                        // Update like count and toggle like button color
                        button.toggleClass('liked');
                        button.next('.like-count').text(response.likes);
                    },
                    error: function(err) {
                        if (err.responseJSON && err.response.JSON.error === "Already like this post"}
                        else{
                        console.error('Error liking image:', err);

                    }
                });
            });
        });

        $(document).ready(function(){
        $('.comment-form')submit(function(event){
        event.preventDefault();
        const form = $(this);
        const imageId = form.data('image-id');
        const commentText = form.find('input[name="comment"]').val();

        $ajax:({

        url = "/comment",
        type = ["GET","POST"],
        contentType: 'application/json',
        data: JSON.stringify({ image_id: imageId, comment: commentText }),



        })

        })

        }
    </script>
</body>
</html>
